{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
    crossorigin="anonymous"/>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
    <title>Railway</title>
</head>
<style type="text/css">
    @-webkit-keyframes slideIn {
      from {bottom: -300px; opacity: 0} 
      to {bottom: 0; opacity: 1}
  }

  @keyframes slideIn {
      from {bottom: -300px; opacity: 0}
      to {bottom: 0; opacity: 1}
  }

  @-webkit-keyframes fadeIn {
      from {opacity: 0} 
      to {opacity: 1}
  }

  @keyframes fadeIn {
      from {opacity: 0} 
      to {opacity: 1}
  }
</style>
<body>
    <div >
        <a href="logout" class="btn" style="float: right; padding: 10px 50px 0px 0px; font-size: 20px">
            <span style="background-color: lightgreen; padding: 5px 5px 5px 5px">Log out</span></a>
        </div>
        <div style="margin-left: 20%">
            <div class="row" style="padding: 50px 15px 5px 15px">
                <button id="but1" onclick="but1()" style="margin: 3% 2% 3% 2%">Profile</button>
                <button id="but2" onclick="but2()" style="margin: 3% 2% 3% 2%">New Journey</button>
                <button id="but3" onclick="but3()" style="margin: 3% 2% 3% 2%">Booked Journey</button>
            </div>
            <div id="profile" style="display: none;">
                <div class="col-md-8">
                    <div class="row">
                        <div class="col-md-6">
                            <label>User Id</label>
                        </div>
                        <div class="col-md-6">
                            <p>{{ userdetails.userId }} </p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label>First Name</label>
                        </div>
                        <div class="col-md-6">
                            <p>{{ userdetails.firstName }} </p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label>Last Name</label>
                        </div>
                        <div class="col-md-6">
                            <p>{{ userdetails.lastName }} </p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label>Aadhar No</label>
                        </div>
                        <div class="col-md-6">
                            <p>{{ userdetails.aadharNo }} </p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label>Date Of Birth</label>
                        </div>
                        <div class="col-md-6">
                            <p>{{ userdetails.dateofbirth }} </p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label>Email</label>
                        </div>
                        <div class="col-md-6">
                            <p>{{ userdetails.email }}</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label>Phone</label>
                        </div>
                        <div class="col-md-6">
                            <p>{{ userdetails.telephone }}</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label>Country</label>
                        </div>
                        <div class="col-md-6">
                            <p>{{ userdetails.country }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="newj" style="display: block;">
                <form class="form-inline" method = "post" action="/home">{% csrf_token %}
                  <label for="date">Date</label>
                  <input type="text" id="forbooking" name="forbooking" value="0" style="display: none;">
                  <input type="date" id="date" placeholder="Date" name="date" value="1212-12-12">
                  <label for="from">Source</label>
                  <input type="text" id="from" placeholder="Source" name="from" value="A">
                  <label for="to">Destination</label>
                  <input type="text" id="to" placeholder="Destination" name="to" value="B">                  
              </label>
              <input type="submit" value="Search">
          </form>
          <br>

          <div id="myModal" class="modal" style="margin-top: 30%; width: 40%">

              <div class="modal-body">
                  <form class="" method = "post" action="/home">{% csrf_token %}
                    <label id = "shownum" >  </label>
                    <br>
                    <label id = "showname" >  </label>
                    <br>
                    <label id = "showdate" >  </label>
                    <br>
                    <input type="text" id="senduser" name="senduser" value="" style="display: none;">
                    <input type="text" id="forbooking" name="forbooking" value="1" style="display: none;">
                    <input type="text" id="senddate"  name="senddate" value="" style="display: none;">
                    <input type="text" id="sendname" name="sendname" value="" style="display: none;">
                    <input type="text" id="sendnum" name="sendnum" value="" style="display: none;">
                    <label for="passname"> Passenger Name</label>
                    <input type="text" name="passname" id="passname" placeholder="">
                    <br>
                    
                    <label for="passage"> Passenger Age:</label>
                    <input type="text" name="passage" id="passage" placeholder="">
                    <br>
                    
                    <label for="type"> Type:</label>
                    <select id="type" name="type">
                        <option id="acfare" value="AC">AC</option>
                        <option id="sittingfare" value="Sitting">Sitting</option>
                        <option id="sleeperfare" value="Sleeper">Sleeper</option>
                    </select>
                    <label for="gender"> Gender:</label>
                    <select id="gender" name="gender">
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                    </select>
                    <button type="submit" class="btn btn-success btn-block"> Book</button>
                </form>
            </div>
        </div>

        <div>
            {% if show %}
            <div id="tenants" style="padding: 50px 0px 0px 0px">
                <table id="myTable">
                  <thead class="header" style="text-align: center">
                    <th style="width: 10%">Train No</th>
                    <th style="width: 10%">Train Name</th>
                    <th style="width: 10%">AC available seats(fare)</th>
                    <th style="width: 10%">Sleeper available seats(fare)</th>
                    <th style="width: 10%">Sitting available seats(fare)</th>
                    <th style="width: 10%">Book</th>
                </thead>
                {% for search in result %}
                <tr style="text-align: center">
                    <td>{{ search.trainNo }}</td>
                    <td>{{ search.trainName }}</td>
                    <td>{{ search.availAC }}({{ search.acfare }})</td>
                    <td>{{ search.availSleeper }}({{ search.sleeperfare }})</td>
                    <td>{{ search.availSitting }}({{ search.sittingfare }})</td>
                    <td><button onclick="bookticket('{{ search.trainNo }}', '{{ search.trainName }}', '{{ search.acfare }}', '{{ search.sleeperfare }}','{{ search.sittingfare }}', '{{ search.date }}')">Book</button></td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}
    </div>
</div>

<div id="bookj" style="display: none">
    <ul>
        {% for book in bookings %}
        <li>
            <p> <b>Train Date: </b>{{ book.traindetails.traindate }} 
                <b>Train Number:</b> {{ book.traindetails.trainNo.trainNo }}
                <b>Train Name:</b> {{ book.traindetails.trainNo.trainName }}</p>
                <p> <b>Pnr Number: </b> {{ book.pnrNo }} 
                    <b>Sitting class:</b> {{ book.seatType }}</p>
                    <p> <b>Passenger Name:</b> {{ book.name }}
                        <b>Age: </b>{{ book.age }}
                        <b>Gender:</b> {{ book.gender }}</p>
                    </li>
                    {% endfor %}
                </ul>
            </div>

        </div>

        <script type="text/javascript">
            function but1(){
                document.getElementById("profile").style.display = "block";
                document.getElementById("newj").style.display = "none"; 
                document.getElementById("bookj").style.display = "none"; 
            }

            function but2(){
                console.log(document.getElementById("newj"))

                document.getElementById("profile").style.display = "none"; 
                document.getElementById("newj").style.display = "block"; 
                document.getElementById("bookj").style.display = "none"; 
            }

            function but3(){
                document.getElementById("profile").style.display = "none"; 
                document.getElementById("newj").style.display = "none"; 
                document.getElementById("bookj").style.display = "block"; 
            }

            var modal = document.getElementById("myModal");

            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }

            function bookticket(trainNo, trainName, acfare, sleeperfare, sittingfare, date){
                document.getElementById("shownum").innerHTML = "Train Number : " + trainNo;
                document.getElementById("showname").innerHTML = "Train Name : " + trainName;
                document.getElementById("showdate").innerHTML = "Journey Date : " + date;
                document.getElementById("senduser").value = "{{ userdetails.userId }}";
                document.getElementById("senddate").value = date;
                document.getElementById("sendnum").value = trainNo;
                document.getElementById("sendname").value = trainName;
                document.getElementById("acfare").innerHTML = "AC(" + acfare + ")";
                document.getElementById("sleeperfare").innerHTML = "Sleeper(" + sleeperfare + ")";
                document.getElementById("sittingfare").innerHTML = "Sitting(" + sittingfare + ")";
                modal.style.display = "block";        
            }
    // var listTrain= [
    // {% for article in trains %}
    // {% if not forloop.first %},{% endif %}
    // {
    //     trainNo: "{{ article.trainNo|escapejs }}",
    //     route: "{{ article.route|escapejs|safe }}",
    //     trainName: "{{ article.trainName|escapejs }}",
    //     availA: "{{ article.availASeats|escapejs }}",
    //     availB: "{{ article.availBSeats|escapejs }}",
    //     availC: "{{ article.availCSeats|escapejs }}"
    // }
    // {% endfor %}
    // ];
    // function searchTrains(){
    //     var source = document.getElementById("from").value;
    //     var destination = document.getElementById("to").value;
    //     var date = document.getElementById("date").value;
    //     console.log(date);

        // for(train of listTrain){
        //     var r = train.route;
        //     var a = r.replace("'","").replace(" ","");
        //     while(r != a){
        //         r = a;
        //         a = r.replace("'", "").replace(" ","");
        //     }
        //     var routes = a.substring(1,a.length-1).split(",");

        //     console.log(routes);
        //     if(routes.includes(source) && routes.includes(destination))
        //         console.log("there");
        // }

    //     console.log("{{ show }}")
        // var form = '<form></form>';
        // form.attr("method", "post");
        // form.attr("action", '/home');

        // var field = $('<input></input>');

        // field.attr("type", "hidden");
        // field.attr("date", date);
        // field.attr("source", value);

        // form.append(field);

        // // The form needs to be a part of the document in
        // // order for us to be able to submit it.
        // document.body.append(form);
        // form.submit();

    // }
</script>
</body>
</html>